"use strict";var Router=React.createClass({displayName:"Router",childContextTypes:{params:React.PropTypes.array,root:React.PropTypes.string,path:React.PropTypes.string,changeRoute:React.PropTypes.func,routerHistory:React.PropTypes.func},getChildContext:function(){return{params:this.state.params,root:this.state.root,path:this.state.path,changeRoute:this.changeRoute,routerHistory:this.routerHistory}},getInitialState:function(){return{path:null,params:null,root:null,props:null}},compareStrArr:function(b,c,d){if(!c||0==c.length)return null;var e=b.filter(function(a){if(d.toString()==a[c].toString())return a});return e?e[0]:null},searchSubArr:function(b,c,d){if(!c||0==c.length)return null;var e=b.filter(function(a){if(0===d.lastIndexOf(a[c],0))return a});return e?e[0]:null},changeRoute:function(b,c,d){var e=this.state.root+b;e=e.replace(/\/\/+/g,"/");var f={};if("/*"==e){var g=this.compareStrArr(this.routingMap,"path","/*");f.path=g.path,f.component=g.component?g.component:null,f.params=null,e="/"}else{if(c)for(var h=0;h<c.length;h++)c[h].length&&(e+="/"+c[h]);var g=this.searchSubArr(this.routingMap,"path",e);g||(g=this.compareStrArr(this.routingMap,"path",e+"/*")),f.path=b,f.component=g.component?g.component:null,f.params=c}this.setState({path:f.path,params:f.params,props:d?d:null,component:f.component}),history.pushState({path:WS_ROOT+e},"",WS_ROOT+e),this.saveHistory(b,c)},routerHistory:function(b){var c=this.historyStack;return b?c.slice(Math.max(c.length-b,0)):c},saveHistory:function(b,c){this.historyStack.push({path:b,params:c})},handlePopState:function(b){b&&b.state&&b.state.path&&this.setPath(b.state.path)},buildRoutes:function(b,c,d){b&&b.props&&(b.props.component&&this.routingMap.push({path:this.props.root+(d?d:"")+b.props.path,component:b.props.component}),React.Children.forEach(b.props.children,function(a){this.buildRoutes(a,c+1,b.props.path)},this))},setPath:function(b,c){var d=b;d=d.replace(/\/\/+/g,"/"),d=d.replace(this.props.root,""),d=d.replace(/\/+$/,""),d=d.length?d.split("/"):null;var e={};if(d){var f=this.props.root+d.join("/"),g=this.searchSubArr(this.routingMap,"path",f);g||(g=this.compareStrArr(this.routingMap,"path",f+"/*")),d=f.replace(g.path,""),e.path=g.path,e.component=g.component?g.component:null,d=d.replace(/\/\/+/g,"/"),d=d.split("/"),d.shift(),e.params=d}else{var d=this.props.root;d=d.replace(/\/+$/,"");var g=this.compareStrArr(this.routingMap,"path",d+"/*");e.path=g.path,e.component=g.component?g.component:null,e.params=null}this.setState({path:e.path?e.path:"/",params:e.params,root:this.props.root,component:e.component},c?c:null)},componentDidMount:function(){this.historyStack=Array(),this.routingMap=Array(),this.buildRoutes(this,0,""),this.setPath(window.location.pathname,function(){this.saveHistory(this.state.path,this.state.params)}),window.addEventListener("popstate",this.handlePopState),window.router=this},render:function(){return!!this.state.path&&(window.scrollTo(0,0),!!this.state.component&&React.cloneElement(this.state.component,this.state.props))}}),Route=React.createClass({displayName:"Route",render:function(){return!1}});